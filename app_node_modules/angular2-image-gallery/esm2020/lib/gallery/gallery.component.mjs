import { ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Input, Output, QueryList, ViewChild, ViewChildren, } from '@angular/core';
import { ImageService } from '../services/image.service';
import { HttpClient } from '@angular/common/http';
import * as i0 from "@angular/core";
import * as i1 from "../services/image.service";
import * as i2 from "@angular/common/http";
import * as i3 from "@angular/common";
import * as i4 from "../viewer/viewer.component";
export class GalleryComponent {
    triggerCycle(_) {
        this.loadImagesInsideView();
    }
    windowResize(_) {
        this.render();
    }
    constructor(imageService, http, changeDetectorRef) {
        this.imageService = imageService;
        this.http = http;
        this.changeDetectorRef = changeDetectorRef;
        this.gallery = [];
        this.baseURL = '';
        this.imageDataStaticPath = 'assets/img/gallery/';
        this.imageMetadataUri = '';
        this.dataFileName = 'data.json';
        this.images = [];
        this.minimalQualityCategory = 'preview_xxs';
        this.rowIndex = 0;
        this.rightArrowInactive = false;
        this.leftArrowInactive = false;
        this.providedImageMargin = 3;
        this.providedImageSize = 7;
        this.providedGalleryName = '';
        this.providedMetadataUri = undefined;
        this.rowsPerPage = 200;
        this.includeViewer = true;
        this.lazyLoadGalleryImages = true;
        this.baseImagesURL = '';
        this.viewerChange = new EventEmitter();
        this.handleErrorWhenLoadingImages = (err) => {
            if (this.providedMetadataUri) {
                console.error(`Provided endpoint '${this.providedMetadataUri}' did not serve metadata correctly or in the expected format.
      See here for more information: https://github.com/BenjaminBrandmeier/angular2-image-gallery/blob/master/docs/externalDataSource.md,
      Original error: ${err}`);
            }
            else {
                console.error(`Did you run the convert script from angular2-image-gallery for your images first? Original error: ${err}`);
            }
        };
        this.isPaginationActive = () => !this.rightArrowInactive || !this.leftArrowInactive;
        this.calcIdealHeight = () => this.getGalleryWidth() / (80 / this.providedImageSize) + 100;
        this.getGalleryWidth = () => this.galleryContainer.nativeElement.clientWidth;
        this.isLastRow = (imgRow) => imgRow === this.gallery[this.gallery.length - 1];
    }
    ngOnInit() {
        this.fetchDataAndRender();
        this.viewerSubscription = this.imageService.showImageViewerChanged$.subscribe((visibility) => this.viewerChange.emit(visibility));
    }
    ngOnChanges(changes) {
        // input params changed
        this.determineBaseURL();
        this.imageMetadataUri = this.determineMetadataPath();
        this.imageDataStaticPath = this.baseURL + this.baseURL;
        if (!changes['providedGalleryName']?.isFirstChange()) {
            this.fetchDataAndRender();
        }
        this.render();
    }
    determineBaseURL() {
        console.log("Determine baseURL start");
        if (this.baseImagesURL.length == 0) {
            console.log("Aborting, No baseImageURL input param.");
            this.baseURL = '';
            return;
        }
        this.baseURL = this.baseImagesURL.endsWith('/') ? this.baseImagesURL : this.baseImagesURL + '/';
        console.log("baseURL: ", this.baseURL);
    }
    ngOnDestroy() {
        if (this.viewerSubscription) {
            this.viewerSubscription.unsubscribe();
        }
    }
    openImageViewer(img) {
        this.imageService.updateImages(this.images);
        this.imageService.updateSelectedImageIndex(this.images.indexOf(img));
        this.imageService.showImageViewer(true);
    }
    /**
     * direction (-1: left, 1: right)
     */
    navigate(direction) {
        if ((direction === 1 && this.rowIndex < this.gallery.length - this.rowsPerPage) || (direction === -1 && this.rowIndex > 0)) {
            this.rowIndex += this.rowsPerPage * direction;
        }
        this.refreshArrowState();
        this.render();
    }
    calcImageMargin() {
        const galleryWidth = this.getGalleryWidth();
        const ratio = galleryWidth / 1920;
        return Math.round(Math.max(1, this.providedImageMargin * ratio));
    }
    fetchDataAndRender() {
        this.http.get(this.imageMetadataUri).subscribe((data) => {
            this.images = data;
            this.imageService.updateImages(this.images);
            this.images.forEach((image) => {
                image['viewerImageLoaded'] = false;
                image['srcAfterFocus'] = '';
            });
            this.render();
        }, this.handleErrorWhenLoadingImages);
    }
    determineMetadataPath() {
        let imageMetadataUri = this.providedMetadataUri;
        if (!this.providedMetadataUri) {
            imageMetadataUri =
                this.providedGalleryName !== ''
                    ? `${this.baseURL}${this.imageDataStaticPath + this.providedGalleryName}/${this.dataFileName}`
                    : this.baseURL + this.imageDataStaticPath + this.dataFileName;
        }
        console.log("Returning metadata file uri: ", imageMetadataUri);
        return imageMetadataUri;
    }
    render() {
        this.gallery = [];
        let tempRow = [this.images[0]];
        let currentRowIndex = 0;
        let i = 0;
        for (i; i < this.images.length; i++) {
            while (this.images[i + 1] && this.shouldAddCandidate(tempRow, this.images[i + 1])) {
                i++;
            }
            if (this.images[i + 1]) {
                tempRow.pop();
            }
            this.gallery[currentRowIndex++] = tempRow;
            tempRow = [this.images[i + 1]];
        }
        this.scaleGallery();
    }
    shouldAddCandidate(imgRow, candidate) {
        const oldDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        imgRow.push(candidate);
        const newDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        return Math.abs(oldDifference) > Math.abs(newDifference);
    }
    calcRowHeight(imgRow) {
        const originalRowWidth = this.calcOriginalRowWidth(imgRow);
        const ratio = (this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin()) / originalRowWidth;
        const rowHeight = imgRow[0].resolutions[this.minimalQualityCategory].height * ratio;
        return rowHeight;
    }
    calcOriginalRowWidth(imgRow) {
        let originalRowWidth = 0;
        imgRow.forEach((img) => {
            const individualRatio = this.calcIdealHeight() / img.resolutions[this.minimalQualityCategory].height;
            img.resolutions[this.minimalQualityCategory].width = img.resolutions[this.minimalQualityCategory].width * individualRatio;
            img.resolutions[this.minimalQualityCategory].height = this.calcIdealHeight();
            originalRowWidth += img.resolutions[this.minimalQualityCategory].width;
        });
        return originalRowWidth;
    }
    scaleGallery() {
        let maximumGalleryImageHeight = 0;
        this.gallery.slice(this.rowIndex, this.rowIndex + this.rowsPerPage).forEach((imgRow) => {
            const originalRowWidth = this.calcOriginalRowWidth(imgRow);
            const calculatedRowWidth = this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin();
            const ratio = this.isLastRow(imgRow) ? 1 : calculatedRowWidth / originalRowWidth;
            imgRow.forEach((img) => {
                img.width = img.resolutions[this.minimalQualityCategory].width * ratio;
                img.height = img.resolutions[this.minimalQualityCategory].height * ratio;
                maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img.height);
            });
        });
        this.minimalQualityCategory = maximumGalleryImageHeight > 375 ? 'preview_xs' : 'preview_xxs';
        this.refreshArrowState();
        this.loadImagesInsideView();
    }
    loadImagesInsideView() {
        this.changeDetectorRef.detectChanges();
        this.images.forEach((image, index) => {
            const imageElements = this.imageElements.toArray();
            if (this.isPaginationActive() || this.isScrolledIntoView(imageElements[index]?.nativeElement) || !this.lazyLoadGalleryImages) {
                image['srcAfterFocus'] = this.baseImagesURL + image.resolutions[this.minimalQualityCategory].path;
            }
        });
    }
    isScrolledIntoView(element) {
        if (!element) {
            return false;
        }
        const elementTop = element.getBoundingClientRect().top;
        const elementBottom = element.getBoundingClientRect().bottom;
        const viewableHeight = document.documentElement.clientHeight;
        return elementTop < viewableHeight && elementBottom >= 0;
    }
    refreshArrowState() {
        this.leftArrowInactive = this.rowIndex == 0;
        this.rightArrowInactive = this.rowIndex >= this.gallery.length - this.rowsPerPage;
    }
}
GalleryComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: GalleryComponent, deps: [{ token: i1.ImageService }, { token: i2.HttpClient }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
GalleryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.1", type: GalleryComponent, selector: "gallery", inputs: { providedImageMargin: ["flexBorderSize", "providedImageMargin"], providedImageSize: ["flexImageSize", "providedImageSize"], providedGalleryName: ["galleryName", "providedGalleryName"], providedMetadataUri: ["metadataUri", "providedMetadataUri"], rowsPerPage: ["maxRowsPerPage", "rowsPerPage"], includeViewer: "includeViewer", lazyLoadGalleryImages: "lazyLoadGalleryImages", baseImagesURL: "baseImagesURL" }, outputs: { viewerChange: "viewerChange" }, host: { listeners: { "window:scroll": "triggerCycle($event)", "resize": "windowResize($event)" } }, viewQueries: [{ propertyName: "galleryContainer", first: true, predicate: ["galleryContainer"], descendants: true, static: true }, { propertyName: "imageElements", predicate: ["imageElement"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div #galleryContainer class=\"galleryContainer\">\r\n  <div class=\"innerGalleryContainer\">\r\n    <div\r\n      *ngFor=\"let imgrow of gallery | slice: rowIndex:rowIndex + rowsPerPage; let i = index\"\r\n      class=\"imagerow\"\r\n      [style.margin-bottom.px]=\"calcImageMargin()\">\r\n      <img\r\n        #imageElement\r\n        *ngFor=\"let img of imgrow; let j = index\"\r\n        class=\"thumbnail\"\r\n        [style.width.px]=\"img['width']\"\r\n        [style.height.px]=\"img['height']\"\r\n        (click)=\"openImageViewer(img)\"\r\n        [src]=\"img['srcAfterFocus']\"\r\n        [style.background]=\"img.dominantColor\"\r\n        [style.margin-right.px]=\"calcImageMargin()\" />\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"pagerContainer\" *ngIf=\"!rightArrowInactive || !leftArrowInactive\">\r\n    <img\r\n      [ngClass]=\"{ inactive: leftArrowInactive }\"\r\n      class=\"pager left\"\r\n      src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNGMwLDExLDksMjAsMjAsMjAgICBjMTEsMCwyMC05LDIwLTIwQzQ0LDEzLDM1LDQsMjQsNHoiLz48L2c+PGc+PHBvbHlnb24gcG9pbnRzPSIyNy42LDM2LjcgMTQuOSwyNCAyNy42LDExLjMgMjkuMSwxMi43IDE3LjgsMjQgMjkuMSwzNS4zICAiLz48L2c+PC9zdmc+\"\r\n      (click)=\"navigate(-1)\" />\r\n    <img\r\n      [ngClass]=\"{ inactive: rightArrowInactive }\"\r\n      class=\"pager right\"\r\n      src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNHM5LDIwLDIwLDIwczIwLTksMjAtMjAgICBTMzUsNCwyNCw0eiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjIxLjQsMzYuNyAxOS45LDM1LjMgMzEuMiwyNCAxOS45LDEyLjcgMjEuNCwxMS4zIDM0LjEsMjQgICIvPjwvZz48L3N2Zz4=\"\r\n      (click)=\"navigate(1)\" />\r\n  </div>\r\n</div>\r\n\r\n<viewer *ngIf=\"includeViewer\" [baseImagesURL] = \"baseURL\"></viewer>\r\n", styles: [".innerGalleryContainer{position:relative}.galleryContainer{height:100%;width:100%;overflow:hidden}.innerGalleryContainer img:last-child{margin-right:-1px!important}.galleryContainer img:hover{filter:brightness(50%);transition:all ease-out .2s;cursor:pointer}.imagerow{margin-right:1px;overflow:hidden;display:flex}::-webkit-scrollbar{display:none}.asyncLoadingContainer{position:absolute;background-color:transparent;height:0px;width:0px;bottom:120px}.pagerContainer{margin:40px auto;width:180px}@media (max-width: 700px){.pagerContainer{margin:40px auto;width:150px}}.pager{display:block;height:60px}@media (max-width: 700px){.pager{display:block;height:45px}}.pager.inactive{opacity:.15;cursor:default}.pager.left{float:left}.pager.right{float:right}\n"], dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.ViewerComponent, selector: "viewer", inputs: ["baseImagesURL"] }, { kind: "pipe", type: i3.SlicePipe, name: "slice" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: GalleryComponent, decorators: [{
            type: Component,
            args: [{ selector: 'gallery', template: "<div #galleryContainer class=\"galleryContainer\">\r\n  <div class=\"innerGalleryContainer\">\r\n    <div\r\n      *ngFor=\"let imgrow of gallery | slice: rowIndex:rowIndex + rowsPerPage; let i = index\"\r\n      class=\"imagerow\"\r\n      [style.margin-bottom.px]=\"calcImageMargin()\">\r\n      <img\r\n        #imageElement\r\n        *ngFor=\"let img of imgrow; let j = index\"\r\n        class=\"thumbnail\"\r\n        [style.width.px]=\"img['width']\"\r\n        [style.height.px]=\"img['height']\"\r\n        (click)=\"openImageViewer(img)\"\r\n        [src]=\"img['srcAfterFocus']\"\r\n        [style.background]=\"img.dominantColor\"\r\n        [style.margin-right.px]=\"calcImageMargin()\" />\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"pagerContainer\" *ngIf=\"!rightArrowInactive || !leftArrowInactive\">\r\n    <img\r\n      [ngClass]=\"{ inactive: leftArrowInactive }\"\r\n      class=\"pager left\"\r\n      src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNGMwLDExLDksMjAsMjAsMjAgICBjMTEsMCwyMC05LDIwLTIwQzQ0LDEzLDM1LDQsMjQsNHoiLz48L2c+PGc+PHBvbHlnb24gcG9pbnRzPSIyNy42LDM2LjcgMTQuOSwyNCAyNy42LDExLjMgMjkuMSwxMi43IDE3LjgsMjQgMjkuMSwzNS4zICAiLz48L2c+PC9zdmc+\"\r\n      (click)=\"navigate(-1)\" />\r\n    <img\r\n      [ngClass]=\"{ inactive: rightArrowInactive }\"\r\n      class=\"pager right\"\r\n      src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNHM5LDIwLDIwLDIwczIwLTksMjAtMjAgICBTMzUsNCwyNCw0eiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjIxLjQsMzYuNyAxOS45LDM1LjMgMzEuMiwyNCAxOS45LDEyLjcgMjEuNCwxMS4zIDM0LjEsMjQgICIvPjwvZz48L3N2Zz4=\"\r\n      (click)=\"navigate(1)\" />\r\n  </div>\r\n</div>\r\n\r\n<viewer *ngIf=\"includeViewer\" [baseImagesURL] = \"baseURL\"></viewer>\r\n", styles: [".innerGalleryContainer{position:relative}.galleryContainer{height:100%;width:100%;overflow:hidden}.innerGalleryContainer img:last-child{margin-right:-1px!important}.galleryContainer img:hover{filter:brightness(50%);transition:all ease-out .2s;cursor:pointer}.imagerow{margin-right:1px;overflow:hidden;display:flex}::-webkit-scrollbar{display:none}.asyncLoadingContainer{position:absolute;background-color:transparent;height:0px;width:0px;bottom:120px}.pagerContainer{margin:40px auto;width:180px}@media (max-width: 700px){.pagerContainer{margin:40px auto;width:150px}}.pager{display:block;height:60px}@media (max-width: 700px){.pager{display:block;height:45px}}.pager.inactive{opacity:.15;cursor:default}.pager.left{float:left}.pager.right{float:right}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ImageService }, { type: i2.HttpClient }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { providedImageMargin: [{
                type: Input,
                args: ['flexBorderSize']
            }], providedImageSize: [{
                type: Input,
                args: ['flexImageSize']
            }], providedGalleryName: [{
                type: Input,
                args: ['galleryName']
            }], providedMetadataUri: [{
                type: Input,
                args: ['metadataUri']
            }], rowsPerPage: [{
                type: Input,
                args: ['maxRowsPerPage']
            }], includeViewer: [{
                type: Input,
                args: ['includeViewer']
            }], lazyLoadGalleryImages: [{
                type: Input,
                args: ['lazyLoadGalleryImages']
            }], baseImagesURL: [{
                type: Input,
                args: ['baseImagesURL']
            }], viewerChange: [{
                type: Output
            }], galleryContainer: [{
                type: ViewChild,
                args: ['galleryContainer', { static: true }]
            }], imageElements: [{
                type: ViewChildren,
                args: ['imageElement']
            }], triggerCycle: [{
                type: HostListener,
                args: ['window:scroll', ['$event']]
            }], windowResize: [{
                type: HostListener,
                args: ['resize', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyMi1pbWFnZS1nYWxsZXJ5L3NyYy9saWIvZ2FsbGVyeS9nYWxsZXJ5LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXIyLWltYWdlLWdhbGxlcnkvc3JjL2xpYi9nYWxsZXJ5L2dhbGxlcnkuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUlMLE1BQU0sRUFDTixTQUFTLEVBRVQsU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQTtBQUN0QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUE7QUFFeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFBOzs7Ozs7QUFRakQsTUFBTSxPQUFPLGdCQUFnQjtJQTJCZ0IsWUFBWSxDQUFDLENBQU07UUFDNUQsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUE7SUFDN0IsQ0FBQztJQUVtQyxZQUFZLENBQUMsQ0FBTTtRQUNyRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDZixDQUFDO0lBRUQsWUFBbUIsWUFBMEIsRUFBUyxJQUFnQixFQUFTLGlCQUFvQztRQUFoRyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFTLFNBQUksR0FBSixJQUFJLENBQVk7UUFBUyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBbENuSCxZQUFPLEdBQVUsRUFBRSxDQUFBO1FBQ25CLFlBQU8sR0FBRyxFQUFFLENBQUE7UUFDWix3QkFBbUIsR0FBVyxxQkFBcUIsQ0FBQTtRQUNuRCxxQkFBZ0IsR0FBVyxFQUFFLENBQUE7UUFDN0IsaUJBQVksR0FBVyxXQUFXLENB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QS9DLFlBQVk7dUJBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE91dHB1dCxcclxuICBRdWVyeUxpc3QsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBWaWV3Q2hpbGQsXHJcbiAgVmlld0NoaWxkcmVuLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXHJcbmltcG9ydCB7IEltYWdlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2ltYWdlLnNlcnZpY2UnXHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvaW50ZXJuYWwvU3Vic2NyaXB0aW9uJ1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnXHJcbmltcG9ydCB7IEltYWdlTWV0YWRhdGEgfSBmcm9tICcuLi9kYXRhL2ltYWdlLW1ldGFkYXRhJ1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdnYWxsZXJ5JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZ2FsbGVyeS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZ2FsbGVyeS5jb21wb25lbnQuc2FzcyddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgR2FsbGVyeUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xyXG4gIGdhbGxlcnk6IGFueVtdID0gW11cclxuICBiYXNlVVJMID0gJydcclxuICBpbWFnZURhdGFTdGF0aWNQYXRoOiBzdHJpbmcgPSAnYXNzZXRzL2ltZy9nYWxsZXJ5LydcclxuICBpbWFnZU1ldGFkYXRhVXJpOiBzdHJpbmcgPSAnJ1xyXG4gIGRhdGFGaWxlTmFtZTogc3RyaW5nID0gJ2RhdGEuanNvbidcclxuICBpbWFnZXM6IEltYWdlTWV0YWRhdGFbXSA9IFtdXHJcbiAgbWluaW1hbFF1YWxpdHlDYXRlZ29yeSA9ICdwcmV2aWV3X3h4cydcclxuICB2aWV3ZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvblxyXG4gIHJvd0luZGV4OiBudW1iZXIgPSAwXHJcbiAgcmlnaHRBcnJvd0luYWN0aXZlOiBib29sZWFuID0gZmFsc2VcclxuICBsZWZ0QXJyb3dJbmFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlXHJcblxyXG4gIEBJbnB1dCgnZmxleEJvcmRlclNpemUnKSBwcm92aWRlZEltYWdlTWFyZ2luOiBudW1iZXIgPSAzXHJcbiAgQElucHV0KCdmbGV4SW1hZ2VTaXplJykgcHJvdmlkZWRJbWFnZVNpemU6IG51bWJlciA9IDdcclxuICBASW5wdXQoJ2dhbGxlcnlOYW1lJykgcHJvdmlkZWRHYWxsZXJ5TmFtZTogc3RyaW5nID0gJydcclxuICBASW5wdXQoJ21ldGFkYXRhVXJpJykgcHJvdmlkZWRNZXRhZGF0YVVyaTogc3RyaW5nID0gdW5kZWZpbmVkXHJcbiAgQElucHV0KCdtYXhSb3dzUGVyUGFnZScpIHJvd3NQZXJQYWdlOiBudW1iZXIgPSAyMDBcclxuICBASW5wdXQoJ2luY2x1ZGVWaWV3ZXInKSBpbmNsdWRlVmlld2VyID0gdHJ1ZVxyXG4gIEBJbnB1dCgnbGF6eUxvYWRHYWxsZXJ5SW1hZ2VzJykgbGF6eUxvYWRHYWxsZXJ5SW1hZ2VzID0gdHJ1ZVxyXG4gIEBJbnB1dCgnYmFzZUltYWdlc1VSTCcpIGJhc2VJbWFnZXNVUkwgPSAnJ1xyXG5cclxuICBAT3V0cHV0KCkgdmlld2VyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpXHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2dhbGxlcnlDb250YWluZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBnYWxsZXJ5Q29udGFpbmVyOiBFbGVtZW50UmVmXHJcbiAgQFZpZXdDaGlsZHJlbignaW1hZ2VFbGVtZW50JykgaW1hZ2VFbGVtZW50czogUXVlcnlMaXN0PGFueT5cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnNjcm9sbCcsIFsnJGV2ZW50J10pIHRyaWdnZXJDeWNsZShfOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMubG9hZEltYWdlc0luc2lkZVZpZXcoKVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcigncmVzaXplJywgWyckZXZlbnQnXSkgd2luZG93UmVzaXplKF86IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5yZW5kZXIoKVxyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIGltYWdlU2VydmljZTogSW1hZ2VTZXJ2aWNlLCBwdWJsaWMgaHR0cDogSHR0cENsaWVudCwgcHVibGljIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge31cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmZldGNoRGF0YUFuZFJlbmRlcigpXHJcbiAgICB0aGlzLnZpZXdlclN1YnNjcmlwdGlvbiA9IHRoaXMuaW1hZ2VTZXJ2aWNlLnNob3dJbWFnZVZpZXdlckNoYW5nZWQkLnN1YnNjcmliZSgodmlzaWJpbGl0eTogYm9vbGVhbikgPT5cclxuICAgICAgdGhpcy52aWV3ZXJDaGFuZ2UuZW1pdCh2aXNpYmlsaXR5KVxyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgLy8gaW5wdXQgcGFyYW1zIGNoYW5nZWRcclxuICAgIHRoaXMuZGV0ZXJtaW5lQmFzZVVSTCgpO1xyXG4gICAgdGhpcy5pbWFnZU1ldGFkYXRhVXJpID0gdGhpcy5kZXRlcm1pbmVNZXRhZGF0YVBhdGgoKVxyXG4gICAgdGhpcy5pbWFnZURhdGFTdGF0aWNQYXRoID0gdGhpcy5iYXNlVVJMICsgdGhpcy5iYXNlVVJMO1xyXG5cclxuICAgIGlmICghY2hhbmdlc1sncHJvdmlkZWRHYWxsZXJ5TmFtZSddPy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgdGhpcy5mZXRjaERhdGFBbmRSZW5kZXIoKVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVuZGVyKClcclxuICB9XHJcblxyXG4gIGRldGVybWluZUJhc2VVUkwoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkRldGVybWluZSBiYXNlVVJMIHN0YXJ0XCIpO1xyXG4gICAgaWYodGhpcy5iYXNlSW1hZ2VzVVJMLmxlbmd0aCA9PSAwKXtcclxuICAgICAgY29uc29sZS5sb2coXCJBYm9ydGluZywgTm8gYmFzZUltYWdlVVJMIGlucHV0IHBhcmFtLlwiKTtcclxuICAgICAgdGhpcy5iYXNlVVJMID0gJyc7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmJhc2VVUkwgPSB0aGlzLmJhc2VJbWFnZXNVUkwuZW5kc1dpdGgoJy8nKSA/IHRoaXMuYmFzZUltYWdlc1VSTCA6IHRoaXMuYmFzZUltYWdlc1VSTCArICcvJztcclxuICAgIGNvbnNvbGUubG9nKFwiYmFzZVVSTDogXCIsIHRoaXMuYmFzZVVSTCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnZpZXdlclN1YnNjcmlwdGlvbikge1xyXG4gICAgICB0aGlzLnZpZXdlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVuSW1hZ2VWaWV3ZXIoaW1nOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnVwZGF0ZUltYWdlcyh0aGlzLmltYWdlcylcclxuICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnVwZGF0ZVNlbGVjdGVkSW1hZ2VJbmRleCh0aGlzLmltYWdlcy5pbmRleE9mKGltZykpXHJcbiAgICB0aGlzLmltYWdlU2VydmljZS5zaG93SW1hZ2VWaWV3ZXIodHJ1ZSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGRpcmVjdGlvbiAoLTE6IGxlZnQsIDE6IHJpZ2h0KVxyXG4gICAqL1xyXG4gIG5hdmlnYXRlKGRpcmVjdGlvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAoKGRpcmVjdGlvbiA9PT0gMSAmJiB0aGlzLnJvd0luZGV4IDwgdGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIHRoaXMucm93c1BlclBhZ2UpIHx8IChkaXJlY3Rpb24gPT09IC0xICYmIHRoaXMucm93SW5kZXggPiAwKSkge1xyXG4gICAgICB0aGlzLnJvd0luZGV4ICs9IHRoaXMucm93c1BlclBhZ2UgKiBkaXJlY3Rpb25cclxuICAgIH1cclxuICAgIHRoaXMucmVmcmVzaEFycm93U3RhdGUoKVxyXG4gICAgdGhpcy5yZW5kZXIoKVxyXG4gIH1cclxuXHJcbiAgY2FsY0ltYWdlTWFyZ2luKCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBnYWxsZXJ5V2lkdGggPSB0aGlzLmdldEdhbGxlcnlXaWR0aCgpXHJcbiAgICBjb25zdCByYXRpbyA9IGdhbGxlcnlXaWR0aCAvIDE5MjBcclxuICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGgubWF4KDEsIHRoaXMucHJvdmlkZWRJbWFnZU1hcmdpbiAqIHJhdGlvKSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmV0Y2hEYXRhQW5kUmVuZGVyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5odHRwLmdldCh0aGlzLmltYWdlTWV0YWRhdGFVcmkpLnN1YnNjcmliZSgoZGF0YTogSW1hZ2VNZXRhZGF0YVtdKSA9PiB7XHJcbiAgICAgIHRoaXMuaW1hZ2VzID0gZGF0YVxyXG4gICAgICB0aGlzLmltYWdlU2VydmljZS51cGRhdGVJbWFnZXModGhpcy5pbWFnZXMpXHJcblxyXG4gICAgICB0aGlzLmltYWdlcy5mb3JFYWNoKChpbWFnZSkgPT4ge1xyXG4gICAgICAgIGltYWdlWyd2aWV3ZXJJbWFnZUxvYWRlZCddID0gZmFsc2VcclxuICAgICAgICBpbWFnZVsnc3JjQWZ0ZXJGb2N1cyddID0gJydcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHRoaXMucmVuZGVyKClcclxuICAgIH0sIHRoaXMuaGFuZGxlRXJyb3JXaGVuTG9hZGluZ0ltYWdlcylcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlRXJyb3JXaGVuTG9hZGluZ0ltYWdlcyA9IChlcnIpID0+IHtcclxuICAgIGlmICh0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcmkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgUHJvdmlkZWQgZW5kcG9pbnQgJyR7dGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpfScgZGlkIG5vdCBzZXJ2ZSBtZXRhZGF0YSBjb3JyZWN0bHkgb3IgaW4gdGhlIGV4cGVjdGVkIGZvcm1hdC5cclxuICAgICAgU2VlIGhlcmUgZm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9CZW5qYW1pbkJyYW5kbWVpZXIvYW5ndWxhcjItaW1hZ2UtZ2FsbGVyeS9ibG9iL21hc3Rlci9kb2NzL2V4dGVybmFsRGF0YVNvdXJjZS5tZCxcclxuICAgICAgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyfWApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBEaWQgeW91IHJ1biB0aGUgY29udmVydCBzY3JpcHQgZnJvbSBhbmd1bGFyMi1pbWFnZS1nYWxsZXJ5IGZvciB5b3VyIGltYWdlcyBmaXJzdD8gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyfWApXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVybWluZU1ldGFkYXRhUGF0aCgpIHtcclxuICAgIGxldCBpbWFnZU1ldGFkYXRhVXJpID0gdGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpXHJcblxyXG4gICAgaWYgKCF0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcmkpIHtcclxuICAgICAgaW1hZ2VNZXRhZGF0YVVyaSA9XHJcbiAgICAgICAgdGhpcy5wcm92aWRlZEdhbGxlcnlOYW1lICE9PSAnJ1xyXG4gICAgICAgICAgPyBgJHt0aGlzLmJhc2VVUkx9JHt0aGlzLmltYWdlRGF0YVN0YXRpY1BhdGggKyB0aGlzLnByb3ZpZGVkR2FsbGVyeU5hbWV9LyR7dGhpcy5kYXRhRmlsZU5hbWV9YFxyXG4gICAgICAgICAgOiB0aGlzLmJhc2VVUkwgKyB0aGlzLmltYWdlRGF0YVN0YXRpY1BhdGggKyB0aGlzLmRhdGFGaWxlTmFtZVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiUmV0dXJuaW5nIG1ldGFkYXRhIGZpbGUgdXJpOiBcIiwgaW1hZ2VNZXRhZGF0YVVyaSk7XHJcbiAgICByZXR1cm4gaW1hZ2VNZXRhZGF0YVVyaVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXIoKTogdm9pZCB7XHJcbiAgICB0aGlzLmdhbGxlcnkgPSBbXVxyXG5cclxuICAgIGxldCB0ZW1wUm93ID0gW3RoaXMuaW1hZ2VzWzBdXVxyXG4gICAgbGV0IGN1cnJlbnRSb3dJbmRleCA9IDBcclxuICAgIGxldCBpID0gMFxyXG5cclxuICAgIGZvciAoaTsgaSA8IHRoaXMuaW1hZ2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHdoaWxlICh0aGlzLmltYWdlc1tpICsgMV0gJiYgdGhpcy5zaG91bGRBZGRDYW5kaWRhdGUodGVtcFJvdywgdGhpcy5pbWFnZXNbaSArIDFdKSkge1xyXG4gICAgICAgIGkrK1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmltYWdlc1tpICsgMV0pIHtcclxuICAgICAgICB0ZW1wUm93LnBvcCgpXHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5nYWxsZXJ5W2N1cnJlbnRSb3dJbmRleCsrXSA9IHRlbXBSb3dcclxuXHJcbiAgICAgIHRlbXBSb3cgPSBbdGhpcy5pbWFnZXNbaSArIDFdXVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2NhbGVHYWxsZXJ5KClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2hvdWxkQWRkQ2FuZGlkYXRlKGltZ1JvdzogYW55W10sIGNhbmRpZGF0ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBvbGREaWZmZXJlbmNlID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKSAtIHRoaXMuY2FsY1Jvd0hlaWdodChpbWdSb3cpXHJcbiAgICBpbWdSb3cucHVzaChjYW5kaWRhdGUpXHJcbiAgICBjb25zdCBuZXdEaWZmZXJlbmNlID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKSAtIHRoaXMuY2FsY1Jvd0hlaWdodChpbWdSb3cpXHJcblxyXG4gICAgcmV0dXJuIE1hdGguYWJzKG9sZERpZmZlcmVuY2UpID4gTWF0aC5hYnMobmV3RGlmZmVyZW5jZSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY1Jvd0hlaWdodChpbWdSb3c6IGFueVtdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsUm93V2lkdGggPSB0aGlzLmNhbGNPcmlnaW5hbFJvd1dpZHRoKGltZ1JvdylcclxuXHJcbiAgICBjb25zdCByYXRpbyA9ICh0aGlzLmdldEdhbGxlcnlXaWR0aCgpIC0gKGltZ1Jvdy5sZW5ndGggLSAxKSAqIHRoaXMuY2FsY0ltYWdlTWFyZ2luKCkpIC8gb3JpZ2luYWxSb3dXaWR0aFxyXG4gICAgY29uc3Qgcm93SGVpZ2h0ID0gaW1nUm93WzBdLnJlc29sdXRpb25zW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV0uaGVpZ2h0ICogcmF0aW9cclxuXHJcbiAgICByZXR1cm4gcm93SGVpZ2h0XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGNPcmlnaW5hbFJvd1dpZHRoKGltZ1JvdzogYW55W10pOiBudW1iZXIge1xyXG4gICAgbGV0IG9yaWdpbmFsUm93V2lkdGggPSAwXHJcbiAgICBpbWdSb3cuZm9yRWFjaCgoaW1nKSA9PiB7XHJcbiAgICAgIGNvbnN0IGluZGl2aWR1YWxSYXRpbyA9IHRoaXMuY2FsY0lkZWFsSGVpZ2h0KCkgLyBpbWcucmVzb2x1dGlvbnNbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XS5oZWlnaHRcclxuICAgICAgaW1nLnJlc29sdXRpb25zW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV0ud2lkdGggPSBpbWcucmVzb2x1dGlvbnNbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XS53aWR0aCAqIGluZGl2aWR1YWxSYXRpb1xyXG4gICAgICBpbWcucmVzb2x1dGlvbnNbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XS5oZWlnaHQgPSB0aGlzLmNhbGNJZGVhbEhlaWdodCgpXHJcbiAgICAgIG9yaWdpbmFsUm93V2lkdGggKz0gaW1nLnJlc29sdXRpb25zW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV0ud2lkdGhcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIG9yaWdpbmFsUm93V2lkdGhcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNQYWdpbmF0aW9uQWN0aXZlID0gKCkgPT4gIXRoaXMucmlnaHRBcnJvd0luYWN0aXZlIHx8ICF0aGlzLmxlZnRBcnJvd0luYWN0aXZlXHJcbiAgcHJpdmF0ZSBjYWxjSWRlYWxIZWlnaHQgPSAoKTogbnVtYmVyID0+IHRoaXMuZ2V0R2FsbGVyeVdpZHRoKCkgLyAoODAgLyB0aGlzLnByb3ZpZGVkSW1hZ2VTaXplKSArIDEwMFxyXG4gIHByaXZhdGUgZ2V0R2FsbGVyeVdpZHRoID0gKCk6IG51bWJlciA9PiB0aGlzLmdhbGxlcnlDb250YWluZXIubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aFxyXG4gIHByaXZhdGUgaXNMYXN0Um93ID0gKGltZ1JvdykgPT4gaW1nUm93ID09PSB0aGlzLmdhbGxlcnlbdGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIDFdXHJcblxyXG4gIHByaXZhdGUgc2NhbGVHYWxsZXJ5KCk6IHZvaWQge1xyXG4gICAgbGV0IG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPSAwXHJcblxyXG4gICAgdGhpcy5nYWxsZXJ5LnNsaWNlKHRoaXMucm93SW5kZXgsIHRoaXMucm93SW5kZXggKyB0aGlzLnJvd3NQZXJQYWdlKS5mb3JFYWNoKChpbWdSb3cpID0+IHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxSb3dXaWR0aCA9IHRoaXMuY2FsY09yaWdpbmFsUm93V2lkdGgoaW1nUm93KVxyXG4gICAgICBjb25zdCBjYWxjdWxhdGVkUm93V2lkdGggPSB0aGlzLmdldEdhbGxlcnlXaWR0aCgpIC0gKGltZ1Jvdy5sZW5ndGggLSAxKSAqIHRoaXMuY2FsY0ltYWdlTWFyZ2luKClcclxuXHJcbiAgICAgIGNvbnN0IHJhdGlvID0gdGhpcy5pc0xhc3RSb3coaW1nUm93KSA/IDEgOiBjYWxjdWxhdGVkUm93V2lkdGggLyBvcmlnaW5hbFJvd1dpZHRoXHJcblxyXG4gICAgICBpbWdSb3cuZm9yRWFjaCgoaW1nKSA9PiB7XHJcbiAgICAgICAgaW1nLndpZHRoID0gaW1nLnJlc29sdXRpb25zW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV0ud2lkdGggKiByYXRpb1xyXG4gICAgICAgIGltZy5oZWlnaHQgPSBpbWcucmVzb2x1dGlvbnNbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XS5oZWlnaHQgKiByYXRpb1xyXG4gICAgICAgIG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPSBNYXRoLm1heChtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0LCBpbWcuaGVpZ2h0KVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnkgPSBtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0ID4gMzc1ID8gJ3ByZXZpZXdfeHMnIDogJ3ByZXZpZXdfeHhzJ1xyXG5cclxuICAgIHRoaXMucmVmcmVzaEFycm93U3RhdGUoKVxyXG4gICAgdGhpcy5sb2FkSW1hZ2VzSW5zaWRlVmlldygpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGxvYWRJbWFnZXNJbnNpZGVWaWV3KCkge1xyXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKClcclxuXHJcbiAgICB0aGlzLmltYWdlcy5mb3JFYWNoKChpbWFnZTogSW1hZ2VNZXRhZGF0YSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBjb25zdCBpbWFnZUVsZW1lbnRzID0gdGhpcy5pbWFnZUVsZW1lbnRzLnRvQXJyYXkoKVxyXG5cclxuICAgICAgaWYgKHRoaXMuaXNQYWdpbmF0aW9uQWN0aXZlKCkgfHwgdGhpcy5pc1Njcm9sbGVkSW50b1ZpZXcoaW1hZ2VFbGVtZW50c1tpbmRleF0/Lm5hdGl2ZUVsZW1lbnQpIHx8ICF0aGlzLmxhenlMb2FkR2FsbGVyeUltYWdlcykge1xyXG4gICAgICAgIGltYWdlWydzcmNBZnRlckZvY3VzJ10gPSB0aGlzLmJhc2VJbWFnZXNVUkwgKyBpbWFnZS5yZXNvbHV0aW9uc1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldLnBhdGhcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNTY3JvbGxlZEludG9WaWV3KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICBjb25zdCBlbGVtZW50VG9wID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3BcclxuICAgIGNvbnN0IGVsZW1lbnRCb3R0b20gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbVxyXG4gICAgY29uc3Qgdmlld2FibGVIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XHJcblxyXG4gICAgcmV0dXJuIGVsZW1lbnRUb3AgPCB2aWV3YWJsZUhlaWdodCAmJiBlbGVtZW50Qm90dG9tID49IDBcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVmcmVzaEFycm93U3RhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxlZnRBcnJvd0luYWN0aXZlID0gdGhpcy5yb3dJbmRleCA9PSAwXHJcbiAgICB0aGlzLnJpZ2h0QXJyb3dJbmFjdGl2ZSA9IHRoaXMucm93SW5kZXggPj0gdGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIHRoaXMucm93c1BlclBhZ2VcclxuICB9XHJcbn1cclxuIiwiPGRpdiAjZ2FsbGVyeUNvbnRhaW5lciBjbGFzcz1cImdhbGxlcnlDb250YWluZXJcIj5cclxuICA8ZGl2IGNsYXNzPVwiaW5uZXJHYWxsZXJ5Q29udGFpbmVyXCI+XHJcbiAgICA8ZGl2XHJcbiAgICAgICpuZ0Zvcj1cImxldCBpbWdyb3cgb2YgZ2FsbGVyeSB8IHNsaWNlOiByb3dJbmRleDpyb3dJbmRleCArIHJvd3NQZXJQYWdlOyBsZXQgaSA9IGluZGV4XCJcclxuICAgICAgY2xhc3M9XCJpbWFnZXJvd1wiXHJcbiAgICAgIFtzdHlsZS5tYXJnaW4tYm90dG9tLnB4XT1cImNhbGNJbWFnZU1hcmdpbigpXCI+XHJcbiAgICAgIDxpbWdcclxuICAgICAgICAjaW1hZ2VFbGVtZW50XHJcbiAgICAgICAgKm5nRm9yPVwibGV0IGltZyBvZiBpbWdyb3c7IGxldCBqID0gaW5kZXhcIlxyXG4gICAgICAgIGNsYXNzPVwidGh1bWJuYWlsXCJcclxuICAgICAgICBbc3R5bGUud2lkdGgucHhdPVwiaW1nWyd3aWR0aCddXCJcclxuICAgICAgICBbc3R5bGUuaGVpZ2h0LnB4XT1cImltZ1snaGVpZ2h0J11cIlxyXG4gICAgICAgIChjbGljayk9XCJvcGVuSW1hZ2VWaWV3ZXIoaW1nKVwiXHJcbiAgICAgICAgW3NyY109XCJpbWdbJ3NyY0FmdGVyRm9jdXMnXVwiXHJcbiAgICAgICAgW3N0eWxlLmJhY2tncm91bmRdPVwiaW1nLmRvbWluYW50Q29sb3JcIlxyXG4gICAgICAgIFtzdHlsZS5tYXJnaW4tcmlnaHQucHhdPVwiY2FsY0ltYWdlTWFyZ2luKClcIiAvPlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcblxyXG4gIDxkaXYgY2xhc3M9XCJwYWdlckNvbnRhaW5lclwiICpuZ0lmPVwiIXJpZ2h0QXJyb3dJbmFjdGl2ZSB8fCAhbGVmdEFycm93SW5hY3RpdmVcIj5cclxuICAgIDxpbWdcclxuICAgICAgW25nQ2xhc3NdPVwieyBpbmFjdGl2ZTogbGVmdEFycm93SW5hY3RpdmUgfVwiXHJcbiAgICAgIGNsYXNzPVwicGFnZXIgbGVmdFwiXHJcbiAgICAgIHNyYz1cImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlBL1BqeHpkbWNnYVdROUlreGhlV1Z5WHpFaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURRNElEUTRPeUlnZG1WeWMybHZiajBpTVM0eElpQjJhV1YzUW05NFBTSXdJREFnTkRnZ05EZ2lJSGh0YkRwemNHRmpaVDBpY0hKbGMyVnlkbVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUlnZUcxc2JuTTZlR3hwYm1zOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUd4cGJtc2lQanhuUGp4d1lYUm9JR1E5SWsweU5DdzBOa014TVM0NUxEUTJMRElzTXpZdU1Td3lMREkwVXpFeExqa3NNaXd5TkN3eWN6SXlMRGt1T1N3eU1pd3lNbE16Tmk0eExEUTJMREkwTERRMmVpQk5NalFzTkVNeE15dzBMRFFzTVRNc05Dd3lOR013TERFeExEa3NNakFzTWpBc01qQWdJQ0JqTVRFc01Dd3lNQzA1TERJd0xUSXdRelEwTERFekxETTFMRFFzTWpRc05Ib2lMejQ4TDJjK1BHYytQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXlOeTQyTERNMkxqY2dNVFF1T1N3eU5DQXlOeTQyTERFeExqTWdNamt1TVN3eE1pNDNJREUzTGpnc01qUWdNamt1TVN3ek5TNHpJQ0FpTHo0OEwyYytQQzl6ZG1jK1wiXHJcbiAgICAgIChjbGljayk9XCJuYXZpZ2F0ZSgtMSlcIiAvPlxyXG4gICAgPGltZ1xyXG4gICAgICBbbmdDbGFzc109XCJ7IGluYWN0aXZlOiByaWdodEFycm93SW5hY3RpdmUgfVwiXHJcbiAgICAgIGNsYXNzPVwicGFnZXIgcmlnaHRcIlxyXG4gICAgICBzcmM9XCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQS9Qanh6ZG1jZ2FXUTlJa3hoZVdWeVh6RWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lEUTRJRFE0T3lJZ2RtVnljMmx2YmowaU1TNHhJaUIyYVdWM1FtOTRQU0l3SURBZ05EZ2dORGdpSUhodGJEcHpjR0ZqWlQwaWNISmxjMlZ5ZG1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpUGp4blBqeHdZWFJvSUdROUlrMHlOQ3cwTmtNeE1TNDVMRFEyTERJc016WXVNU3d5TERJMFV6RXhMamtzTWl3eU5Dd3ljekl5TERrdU9Td3lNaXd5TWxNek5pNHhMRFEyTERJMExEUTJlaUJOTWpRc05FTXhNeXcwTERRc01UTXNOQ3d5TkhNNUxESXdMREl3TERJd2N6SXdMVGtzTWpBdE1qQWdJQ0JUTXpVc05Dd3lOQ3cwZWlJdlBqd3ZaejQ4Wno0OGNHOXNlV2R2YmlCd2IybHVkSE05SWpJeExqUXNNell1TnlBeE9TNDVMRE0xTGpNZ016RXVNaXd5TkNBeE9TNDVMREV5TGpjZ01qRXVOQ3d4TVM0eklETTBMakVzTWpRZ0lDSXZQand2Wno0OEwzTjJaejQ9XCJcclxuICAgICAgKGNsaWNrKT1cIm5hdmlnYXRlKDEpXCIgLz5cclxuICA8L2Rpdj5cclxuPC9kaXY+XHJcblxyXG48dmlld2VyICpuZ0lmPVwiaW5jbHVkZVZpZXdlclwiIFtiYXNlSW1hZ2VzVVJMXSA9IFwiYmFzZVVSTFwiPjwvdmlld2VyPlxyXG4iXX0=